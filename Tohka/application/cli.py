from Tohka.lib.colors import Colors # type: ignore

from Tohka.lib.ui import (# type: ignore
    BANNER, 
    TOHKA
)

from .module_handler import call_module

from .exceptions import(
    UnknownModError,
    CliError
)


def main() -> None:
    """Custom CLI shell
    - Parses arguments

    Args:
        None
    
    Returns:
        None
    """
    print(f'\x1bc{BANNER}')
    while True:
        request: None | str = None
        try:
            """
            Input your commands.
            ex:  {function} {params}
            """
            shell: str = input(f'{Colors.WHITE}[{Colors.YELLOW}root{Colors.WHITE}@{Colors.WHITE}{TOHKA}{Colors.WHITE}]~ ') # type: ignore

            #NOTE: No input is found? raise CliError
            if not shell:
                raise CliError()
 
            #NOTE: We now parse the input (look for module name)
            cmd: str = shell.split()[0].lower()
                
            #NOTE: If any params are found its set as the request.
            if (params := shell[len(cmd):]):
                request: str = params[1:]
                    
            #NOTE: We call on the module handler now.
            if not call_module(cmd, request):
                #NOTE: If unknown input is put then raise UnknownModError
                raise UnknownModError
                
        except KeyboardInterrupt:
            break

        except Exception as e:
            print(f'\n{Colors.WHITE}Exception: {Colors.RED}{e}{Colors.WHITE}\n') # type: ignore
                